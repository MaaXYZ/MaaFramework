# å¼€å‘æ€è·¯

MaaFramework æ”¯æŒé€šè¿‡ Json ä½ä»£ç ç¼–ç¨‹ï¼ˆPipeline Jsonï¼‰ï¼›åŒæ—¶ä¹Ÿæä¾›äº† C++, [Python](https://pypi.org/project/MaaFw/) ç»‘å®šä»¥ä¾›å¼€å‘è€…æ›´çµæ´»çš„æ“ä½œï¼›è¿˜å¯ä»¥å°†ä½ä»£ç ä½œä¸ºä¸€ç§ â€œå°è£…â€ è¿›è¡Œè°ƒç”¨ã€‚ä¸‹é¢ä»‹ç»å‡ ç§å¸¸ç”¨çš„é›†æˆæ–¹å¼ï¼š

## å®Œå…¨ä¾èµ– Json ä½ä»£ç ç¼–ç¨‹ï¼ˆä½¿ç”¨ MaaPiCli.exeï¼‰

ç®€å•å¿«æ·ï¼Œä½†ä¸å¤Ÿçµæ´»ï¼Œæ¨è MaaFramework åˆå­¦è€…åŠç¼–ç¨‹å°ç™½ä½¿ç”¨ã€‚  
æˆ‘ä»¬ä¸ºæ­¤æ–¹å¼æä¾›äº† [ğŸï¸è§†é¢‘æ•™ç¨‹](https://www.bilibili.com/video/BV1yr421E7MW) å’Œ [â­é¡¹ç›®æ¨¡æ¿](https://github.com/MaaXYZ/MaaPracticeBoilerplate)ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªä¾‹å­ï¼š

```jsonc
{
    "è¯†åˆ«å¹¶ç‚¹å‡»å¼€å§‹æŒ‰é’®": {
        "recognition": "OCR",           // æ–‡å­—è¯†åˆ«
        "expected": "å¼€å§‹",             // è¦è¯†åˆ«çš„å­—
        "action": "Click",              // åŠ¨ä½œï¼šç‚¹å‡»
        "next": [
            "è¯†åˆ«å¹¶ç‚¹å‡»ç¡®å®šå›¾æ ‡",
        ]
    },
    "è¯†åˆ«å¹¶ç‚¹å‡»ç¡®è®¤å›¾æ ‡": {
        "recognition": "TemplateMatch", // å›¾ç‰‡æ¨¡æ¿åŒ¹é…
        "template": "ç¡®è®¤.png",         // å›¾ç‰‡æ–‡ä»¶å
        "action": "Click"
    }
}
```

## ä½¿ç”¨ Json ä½ä»£ç ç¼–ç¨‹ï¼Œä½†å¯¹å¤æ‚ä»»åŠ¡ä½¿ç”¨è‡ªå®šä¹‰é€»è¾‘

é€šè¿‡æ¥å£å¯åŠ¨ CLIï¼ŒåŒæ—¶æ³¨å†Œéƒ¨åˆ†è‡ªå®šä¹‰ä»»åŠ¡ã€‚è¯¥æ–¹æ³•å¯ä» 1 ä¸­æ— ç¼åˆ‡æ¢ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªä¾‹å­ï¼š

```jsonc
{
    "è¯†åˆ«å¹¶ç‚¹å‡»ç¡®è®¤å›¾æ ‡": {
        "next": [
            "æˆ‘çš„è‡ªå®šä¹‰ä»»åŠ¡"
        ]
    },
    "æˆ‘çš„è‡ªå®šä¹‰ä»»åŠ¡": {
        "recognition": "Custom",
        "custom_recognition": "MyReco",
        "action": "Custom",
        "custom_action": "MyAct"
    }
}
```

```python
# æ­¤å¤„ä¸ºä¼ªä»£ç ï¼Œä»…ä¾›å‚è€ƒæ€è·¯ï¼Œæ— æ³•ç›´æ¥è¿è¡Œ
def main():
    my_act = MyAction()
    my_reco = MyRecognizer()
    maafw.Toolkit.register_custom_recognition("MyReco", my_reco)
    maafw.Toolkit.register_custom_action("MyAct", my_act)
    maafw.Toolkit.run_pi_cli()  # è¿™ä¸€è¡Œç›¸å½“äºå¯åŠ¨ MaaPiCli.exe

class MyReco(CustomRecognizer):
    def analyze(context, ...):
        image = context.controller().cached_image()

class MyAction(CustomAction):
    def run(context, ...):
        context.controller().post_click(100, 10).wait()
```

## è‡ªè¡Œç¼–å†™ä»£ç ã€‚å¯ä»¥å°†ä½ä»£ç ä½œä¸ºä¸€ç§â€œå°è£…â€è¿›è¡Œè°ƒç”¨ï¼Œäº¦å¯æ³¨å†Œè‡ªå®šä¹‰å›è°ƒä½¿ç”¨

```python
# æ­¤å¤„ä¸ºä¼ªä»£ç ï¼Œä»…ä¾›å‚è€ƒæ€è·¯ï¼Œæ— æ³•ç›´æ¥è¿è¡Œ
# "è¯†åˆ«ç»“ç®—ç”»é¢", "ç‚¹å‡»ç¡®è®¤" ç­‰å‡ä¸º Json ä¸­çš„é€»è¾‘
def main():
    detail = tasker.post_recognition("è¯†åˆ«ç»“ç®—ç”»é¢").wait().get()

    if detail.text == "æˆ˜æ–—å¤±è´¥":
        tasker.controller().post_click(100, 100).wait()

    else detail.text == "æˆ˜æ–—å®Œæˆ":
        image = tasker.controller().cached_image()
        save_to_file(image)

        my_act = MyAction()
        tasker.resource().register_custom_action("MyAction", my_act)
        tasker.post_pipeline("è¯†åˆ«å¹¶ç‚¹å‡»ç¡®è®¤å›¾æ ‡").wait()

```
