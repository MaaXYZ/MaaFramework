# å¿«é€Ÿå¼€å§‹

## å¼€å‘æ€è·¯

MaaFramework æä¾›ä¸‰ç§é›†æˆæ–¹æ¡ˆï¼Œæ»¡è¶³ä¸åŒå¼€å‘åœºæ™¯éœ€æ±‚ï¼š

### æ–¹æ¡ˆä¸€ï¼šçº¯ JSON ä½ä»£ç ç¼–ç¨‹ï¼ˆé€šç”¨ UIï¼‰

**é€‚ç”¨åœºæ™¯**ï¼šå¿«é€Ÿå…¥é—¨ã€ç®€å•é€»è¾‘å®ç°

**ç‰¹ç‚¹**:

- é›¶ç¼–ç åŸºç¡€è¦æ±‚
- é€šè¿‡ JSON é…ç½®å®ç°è‡ªåŠ¨åŒ–æµç¨‹
- é…å¥— [ğŸï¸è§†é¢‘æ•™ç¨‹](https://www.bilibili.com/video/BV1yr421E7MW) å’Œ [â­é¡¹ç›®æ¨¡æ¿](https://github.com/MaaXYZ/MaaPracticeBoilerplate)

```jsonc
{
    "ç‚¹å‡»å¼€å§‹æŒ‰é’®": {
        "recognition": "OCR",          // æ–‡å­—è¯†åˆ«å¼•æ“
        "expected": "å¼€å§‹",            // ç›®æ ‡æ–‡æœ¬
        "action": "Click",             // æ‰§è¡Œç‚¹å‡»æ“ä½œ
        "next": ["ç‚¹å‡»ç¡®è®¤å›¾æ ‡"]        // åç»­ä»»åŠ¡é“¾
    },
    "ç‚¹å‡»ç¡®è®¤å›¾æ ‡": {
        "recognition": "TemplateMatch",// å›¾åƒæ¨¡æ¿åŒ¹é…
        "template": "ç¡®è®¤.png",        // åŒ¹é…ç´ æè·¯å¾„
        "action": "Click"
    }
}
```

### æ–¹æ¡ˆäºŒï¼šJSON + è‡ªå®šä¹‰é€»è¾‘æ‰©å±•ï¼ˆæ¨èï¼‰

**ğŸ’¡ v4.x ç‰ˆæœ¬æ ¸å¿ƒç‰¹æ€§**

**ç‰¹ç‚¹**:

- ä¿ç•™ JSON ä½ä»£ç ä¼˜åŠ¿
- é€šè¿‡ AgentServer æ³¨å†Œè‡ªå®šä¹‰ä»»åŠ¡æ¨¡å—
- æ— ç¼è¡”æ¥ [â­é¡¹ç›®æ¨¡æ¿](https://github.com/MaaXYZ/MaaPracticeBoilerplate)

```jsonc
{
    "ç‚¹å‡»ç¡®è®¤å›¾æ ‡": {
        "next": ["è‡ªå®šä¹‰å¤„ç†æ¨¡å—"]
    },
    "è‡ªå®šä¹‰å¤„ç†æ¨¡å—": {
        "recognition": "Custom",
        "custom_recognition": "MyReco",  // è‡ªå®šä¹‰è¯†åˆ«å™¨ID
        "action": "Custom",
        "custom_action": "MyAct"         // è‡ªå®šä¹‰åŠ¨ä½œID
    }
}
```

ğŸ’¡ é€šç”¨ UI ä¼šè‡ªåŠ¨è¿æ¥æ‚¨çš„ AgentServer å­è¿›ç¨‹ï¼Œå¹¶åœ¨æ‰§è¡Œåˆ° `MyReco`/`MyAct` æ—¶ï¼Œè°ƒç”¨å¯¹åº”çš„è¯†åˆ«/åŠ¨ä½œã€‚

```python
# Python ä¼ªä»£ç ç¤ºä¾‹
from maa.agent.agent_server import AgentServer

# æ³¨å†Œè‡ªå®šä¹‰è¯†åˆ«å™¨
@AgentServer.custom_recognition("MyReco")
class CustomReco:
    def analyze(ctx):
        return (10,10,100,100)  # è¿”å›æ‚¨è‡ªå·±å¤„ç†çš„è¯†åˆ«ç»“æœ

# æ³¨å†Œè‡ªå®šä¹‰åŠ¨ä½œ 
@AgentServer.custom_action("MyAct")
class CustomAction:
    def run(ctx):
        ctx.controller.post_click(100, 10).wait()  # æ‰§è¡Œç‚¹å‡»
        ctx.override_next(["TaskA", "TaskB"])      # åŠ¨æ€è°ƒæ•´ä»»åŠ¡æµ

# å¯åŠ¨AgentæœåŠ¡
AgentServer.start_up(sock_id)
```

å®Œæ•´ç¤ºä¾‹å‚è€ƒ [æ¨¡æ¿ Commit](https://github.com/MaaXYZ/MaaPracticeBoilerplate/commit/126a56cefc17bf6c8335c703387d8d3ee2dad4d1)ã€‚

### æ–¹æ¡ˆä¸‰ï¼šå…¨ä»£ç å¼€å‘

**é€‚ç”¨åœºæ™¯**:

- æ·±åº¦å®šåˆ¶éœ€æ±‚
- å¤æ‚ä¸šåŠ¡é€»è¾‘å®ç°
- éœ€è¦çµæ´»æ§åˆ¶æ‰§è¡Œæµç¨‹

```python
# Python ä¼ªä»£ç ç¤ºä¾‹
def main():
    # æ‰§è¡Œ JSON é¢„å®šä¹‰ä»»åŠ¡
    result = tasker.post_task("ç‚¹å‡»å¼€å§‹æŒ‰é’®").wait().get()
    
    if result.completed:
        # æ‰§è¡Œä»£ç çº§æ“ä½œ
        tasker.controller.post_click(100, 100)
    else:
        # è·å–å½“å‰å±å¹•æˆªå›¾
        image = tasker.controller.cached_image
        # æ³¨å†Œè‡ªå®šä¹‰åŠ¨ä½œ
        tasker.resource.register_custom_action("MyAction", MyAction())
        # æ‰§è¡Œæ··åˆä»»åŠ¡é“¾
        tasker.post_task("ç‚¹å‡»ç¡®è®¤å›¾æ ‡").wait()
```

## èµ„æºå‡†å¤‡

### æ–‡ä»¶ç»“æ„è§„èŒƒ

*â­è‹¥æ‚¨ä½¿ç”¨é¡¹ç›®æ¨¡æ¿ï¼Œç›´æ¥åœ¨ [æ–‡ä»¶å¤¹](https://github.com/MaaXYZ/MaaPracticeBoilerplate/tree/main/assets/resource) ä¸­ä¿®æ”¹å³å¯ã€‚*

```tree
my_resource/
â”œâ”€â”€ image/                # å›¾åƒç´ æåº“
â”‚   â”œâ”€â”€ my_button_ok.png
â”‚   â””â”€â”€ my_icon_close.png
â”œâ”€â”€ model/
â”‚   â””â”€â”€ ocr/              # æ–‡å­—è¯†åˆ«æ¨¡å‹
â”‚       â”œâ”€â”€ det.onnx
â”‚       â”œâ”€â”€ keys.txt
â”‚       â””â”€â”€ rec.onnx
â””â”€â”€ pipeline/             # ä»»åŠ¡æµæ°´çº¿
    â”œâ”€â”€ my_main.json
    â””â”€â”€ my_subflow.json
```

å…¶ä¸­ä»¥ `my_` å¼€å¤´çš„æ–‡ä»¶/æ–‡ä»¶å¤¹å‡å¯è‡ªè¡Œä¿®æ”¹åç§°ï¼Œå…¶ä»–çš„åˆ™ä¸ºå›ºå®šæ–‡ä»¶åï¼Œä¸å¯ä¿®æ”¹ï¼Œä¸‹é¢ä¾æ¬¡ä»‹ç»ï¼š

### ä»»åŠ¡æµæ°´çº¿

`my_resource/pipeline` ä¸­çš„æ–‡ä»¶ï¼ŒåŒ…å«ä¸»è¦çš„è„šæœ¬æ‰§è¡Œé€»è¾‘ï¼Œä¼šé€’å½’è¯»å–ç›®å½•ä¸­æ‰€æœ‰çš„ json æ ¼å¼æ–‡ä»¶ã€‚

å¯å‚è€ƒ [ä»»åŠ¡æµæ°´çº¿åè®®](3.1-ä»»åŠ¡æµæ°´çº¿åè®®.md) è¿›è¡Œç¼–å†™ï¼Œä¸€ä¸ªç®€å•çš„ [demo](https://github.com/MaaXYZ/MaaFramework/blob/main/sample/resource/pipeline/sample.json)

å°å·¥å…·ï¼š

- [JSON Schema](https://github.com/MaaXYZ/MaaFramework/blob/main/tools/pipeline.schema.json)
- [VSCode æ’ä»¶](https://marketplace.visualstudio.com/items?itemName=nekosu.maa-support)
  - åŸºäº `interface.json` é…ç½®èµ„æº
  - æ”¯æŒè·³è½¬åˆ°ä»»åŠ¡å®šä¹‰ã€æŸ¥æ‰¾ä»»åŠ¡å¼•ç”¨ã€é‡å‘½åä»»åŠ¡ã€è¡¥å…¨ä»»åŠ¡ã€ç‚¹å‡»æ‰§è¡Œä»»åŠ¡
  - æ”¯æŒæŒ‰ç…§ MaaPiCli æ¨¡å¼æ‰§è¡Œ
  - æ”¯æŒè¿æ¥åæˆªå›¾å¹¶è£å‰ªå›¾ç‰‡

### å›¾åƒç´ æ

`my_resource/image` ä¸­çš„æ–‡ä»¶ï¼Œä¸»è¦ä¸º pipeline æ‰€ç”¨åˆ°çš„æ¨¡æ¿åŒ¹é…å›¾ç‰‡ã€ç‰¹å¾æ£€æµ‹å›¾ç‰‡ç­‰ï¼Œä¼šæŒ‰ç…§ pipeline ä¸­è®¾å®šçš„ `template` ç­‰å­—æ®µè¯»å–å¯¹åº”çš„æ–‡ä»¶ã€‚

æ‰€ä½¿ç”¨çš„å›¾ç‰‡éœ€è¦æ˜¯æ— æŸåŸå›¾ç¼©æ”¾åˆ° 720p åçš„è£å‰ªã€‚**é™¤éä½ å®Œå…¨æ¸…æ¥š MaaFramework åœ¨åšä»€ä¹ˆï¼Œå¦åˆ™è¯·ä½¿ç”¨ä¸‹é¢çš„æˆªå›¾å·¥å…·æ¥è·å–å›¾ç‰‡ã€‚**

- [VSCode æ’ä»¶](https://marketplace.visualstudio.com/items?itemName=nekosu.maa-support)
- [MFA å°å·¥å…·](https://github.com/SweetSmellFox/MFATools)
- [å›¾ç‰‡è£å‰ªåŠ ROI è·å–å·¥å…·](https://github.com/MaaXYZ/MaaFramework/tree/main/tools/ImageCropper)

### æ–‡å­—è¯†åˆ«æ¨¡å‹æ–‡ä»¶

*â­è‹¥æ‚¨ä½¿ç”¨é¡¹ç›®æ¨¡æ¿ï¼Œç›´æ¥æŒ‰ç…§å…¶æ–‡æ¡£ï¼Œè¿è¡Œ `configure.py` å³å¯è‡ªåŠ¨éƒ¨ç½²æ¨¡å‹æ–‡ä»¶ã€‚*

`my_resource/model/ocr` ä¸­çš„æ–‡ä»¶ï¼Œä¸º [PaddleOCR](https://github.com/PaddlePaddle/PaddleOCR) è½¬ ONNX åçš„æ¨¡å‹æ–‡ä»¶ã€‚

å¯ä½¿ç”¨æˆ‘ä»¬çš„é¢„è½¬æ¢æ–‡ä»¶ï¼š[MaaCommonAssets](https://github.com/MaaXYZ/MaaCommonAssets/tree/main/OCR)ï¼Œé€‰æ‹©éœ€è¦çš„è¯­ç§ï¼ŒæŒ‰ç…§ [ä¸Šè¿°](#å‡†å¤‡èµ„æºæ–‡ä»¶) ç›®å½•ç»“æ„å­˜æ”¾å³å¯ã€‚

è‹¥æœ‰éœ€è¦ä¹Ÿå¯ä»¥è‡ªè¡Œå¯¹ PaddleOCR çš„å®˜æ–¹é¢„è®­ç»ƒæ¨¡å‹è¿›è¡Œ fine-tuning ï¼ˆè¯·è‡ªè¡Œå‚è€ƒ [PaddleOCR](https://github.com/PaddlePaddle/PaddleOCR) å®˜æ–¹æ–‡æ¡£ï¼‰ï¼Œå¹¶è½¬æ¢æˆ ONNX æ–‡ä»¶ä½¿ç”¨ï¼Œè½¬æ¢å‘½ä»¤å¯å‚è€ƒ [è¿™é‡Œ](https://github.com/MaaXYZ/MaaCommonAssets/tree/main/OCR#command)

## è°ƒè¯•

- ä½¿ç”¨ [å¼€å‘å·¥å…·](https://github.com/MaaXYZ/MaaFramework/tree/main?tab=readme-ov-file#%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7)
- éƒ¨åˆ†å·¥å…·ä¼šåœ¨åŒç›®å½•ä¸‹ç”Ÿæˆ `config/maa_option.json` æ–‡ä»¶ï¼Œå…¶ä¸­ï¼š

  - `logging`: ä¿å­˜æ—¥å¿—ï¼Œä¼šç”Ÿæˆ `debug/maa.log`ã€‚é»˜è®¤ true ã€‚
  - `recording`: ä¿å­˜å½•åƒåŠŸèƒ½ï¼Œä¼šä¿å­˜è¿è¡ŒæœŸé—´æ‰€æœ‰çš„æˆªå›¾åŠæ“ä½œæ•°æ®ï¼Œå¯ä½¿ç”¨ `DbgController` è¿›è¡Œå¤ç°è°ƒè¯•ã€‚é»˜è®¤ false ã€‚
  - `save_draw`: ä¿å­˜å›¾åƒè¯†åˆ«å¯è§†åŒ–ç»“æœï¼Œä¼šä¿å­˜è¿è¡ŒæœŸé—´æ‰€æœ‰å›¾åƒè¯†åˆ«å¯è§†åŒ–ç»“æœç»˜åˆ¶å›¾ã€‚é»˜è®¤ false ã€‚
  - `show_hit_draw`: æ˜¾ç¤ºèŠ‚ç‚¹å‘½ä¸­å¼¹çª—ï¼Œæ¯æ¬¡è¯†åˆ«æˆåŠŸä¼šå¼¹çª—æ˜¾ç¤ºè¯†åˆ«ç»“æœã€‚é»˜è®¤ false ã€‚
  - `stdout_level`: æ§åˆ¶å°æ˜¾ç¤ºæ—¥å¿—ç­‰çº§ã€‚é»˜è®¤ 2ï¼ˆErrorï¼‰ï¼Œå¯è®¾ä¸º 0 å…³é—­å…¨éƒ¨æ§åˆ¶å°æ—¥å¿—ï¼Œæˆ–è®¾ä¸º 7 æ‰“å¼€å…¨éƒ¨æ§åˆ¶å°æ—¥å¿—ã€‚

- è‹¥è‡ªè¡Œé›†æˆï¼Œå¯é€šè¿‡ `Toolkit.init_option` / `MaaToolkitConfigInitOption` æ¥å£å¼€å¯è°ƒè¯•é€‰é¡¹ã€‚ç”Ÿæˆçš„ json æ–‡ä»¶åŒä¸Šã€‚

## è¿è¡Œ

ä½¿ç”¨ é€šç”¨ UIï¼ˆå¦‚ MaaPiCli, MFA, MFW ç­‰ï¼‰æˆ–è€… è‡ªè¡Œç¼–å†™é›†æˆä»£ç 

### ä½¿ç”¨ MaaPiCli

*â­è‹¥æ‚¨ä½¿ç”¨é¡¹ç›®æ¨¡æ¿ï¼Œç›´æ¥æŒ‰ç…§å…¶æ–‡æ¡£ï¼Œè¿è¡Œ `install.py` åå³å¯è‡ªåŠ¨æ‰“åŒ…ç›¸å…³æ–‡ä»¶*

ä½¿ç”¨ Release åŒ… bin æ–‡ä»¶å¤¹ä¸­çš„ MaaPiCli ï¼Œå¹¶ç¼–å†™ `interface.json` ç½®äºåŒç›®å½•ä¸‹ï¼Œå³å¯ä½¿ç”¨

- [interface.json æ–‡æ¡£](3.2-ProjectInterfaceåè®®.md)
- [Sample](https://github.com/MaaXYZ/MaaFramework/blob/main/sample/interface.json)

å®è·µ:

- [M9A](https://github.com/MaaXYZ/M9A/tree/main/assets/interface.json)

### è‡ªè¡Œç¼–å†™é›†æˆä»£ç 

è¯·å‚è€ƒ [é›†æˆæ–‡æ¡£](2.1-é›†æˆæ–‡æ¡£.md)
