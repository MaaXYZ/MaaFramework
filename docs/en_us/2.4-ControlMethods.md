# Control Methods

This document provides detailed explanations of the various Input (control) and Screencap (screenshot) methods in MaaFramework and their configurations.

> [!TIP]
>
> - For APIs, input/screencap uses `int` type (bitwise OR combination); for [ProjectInterface V2](3.3-ProjectInterfaceV2.md), use `string` type (use the name directly).
> - [ProjectInterface V2](3.3-ProjectInterfaceV2.md) only supports configuring input/screencap methods for Win32 controllers. For Adb controllers, use `MaaToolkitAdbDeviceFind` automatically detects and selects the optimal method, no manual configuration required.

## Adb

### Adb Input

> Reference: [MaaDef.h](https://github.com/MaaXYZ/MaaFramework/blob/main/include/MaaFramework/MaaDef.h#L227-L240)

Combine the selected methods below using **bitwise OR** to provide a single value. MaaFramework will try all provided methods in a fixed priority order and select the first available method.

By default, all methods except EmulatorExtras are attempted.

> Priority: EmulatorExtras > Maatouch > MinitouchAndAdbKey > AdbShell

| Name | Value | Description |
| --- | --- | --- |
| AdbShell | `1` | Uses adb process for control. |
| MinitouchAndAdbKey | `2` | Uses adb process for key control and minitouch tool for touch control. |
| Maatouch | `4` | Uses maatouch tool for control. |
| EmulatorExtras | `8` | Uses emulator-specific tools for control. Currently supported emulators: MuMu 12 |

### Adb Screencap

> Reference: [MaaDef.h](https://github.com/MaaXYZ/MaaFramework/blob/main/include/MaaFramework/MaaDef.h#L208-L225)

Combine the selected methods below using **bitwise OR** to provide a single value. MaaFramework will try all provided methods and select the fastest available method.

By default, all methods except `RawByNetcat`, `MinicapDirect`, and `MinicapStream` are attempted.

`MinicapDirect` and `MinicapStream` encode to jpg (lossy compression), which significantly reduces template matching effectiveness and are not recommended.

| Name | Value | Description |
| --- | --- | --- |
| EncodeToFileAndPull | `1` | Takes screenshot via built-in screencap process, encodes to png file, pulls file via adb process, reads file. |
| Encode | `2` | Takes screenshot via built-in screencap process, encodes to png, transfers via adb process pipe. |
| RawWithGzip | `4` | Takes screenshot via built-in screencap process, compresses with gzip, transfers via adb process pipe. |
| RawByNetcat | `8` | Takes screenshot via built-in screencap process, transfers via nc process over network. |
| MinicapDirect | `16` | Takes screenshot and encodes to jpg via minicap tool, transfers via adb process pipe. |
| MinicapStream | `32` | Takes streaming screenshots and encodes to jpg via minicap tool, transfers via adb process pipe. |
| EmulatorExtras | `64` | Uses emulator-specific tools for screenshots. Currently supported emulators: MuMu 12, LDPlayer 9 |

## Win32

### Win32 Input

> Reference: [MaaDef.h](https://github.com/MaaXYZ/MaaFramework/blob/main/include/MaaFramework/MaaDef.h#L252-L259)

Select one of the values below.

No default value. Client can choose one as the default.

Different programs on Win32 handle input differently, so there is no universal method.

| Name | Value | Description |
| --- | --- | --- |
| Seize | `1` | Exclusive control. Uses `SendInput`/foreground focus for input; steals focus, moves system cursor, blocks user input, cannot control in background. |
| SendMessage | `2` | Sends `WM_*` messages directly to the window; can control in background (window can lose focus), but subject to UIPI/permission restrictions: if target is a high-integrity process (run as administrator), must run with equal or higher privileges. |
| PostMessage | `4` | Similar to `SendMessage` but posts asynchronously; can control in background, same UIPI/permission restrictions apply. |
| LegacyEvent | `8` | Legacy `mouse_event`/`keybd_event` interface; depends on foreground and system cursor, blocks user input, generally poorer compatibility, cannot control in background. |
| PostThreadMessage | `16` | Posts messages to the window's thread message queue; can control in background, but requires target thread to have a message loop, same UIPI/permission restrictions apply. |
| SendMessageWithCursorPos | `32` | Combines `SendMessage` with actual cursor movement; moves system cursor to target position via `SetCursorPos` before sending synchronous messages. Designed for games like Genshin Impact that detect actual mouse position, can control in background, same UIPI/permission restrictions apply. |
| PostMessageWithCursorPos | `64` | Combines `PostMessage` with actual cursor movement; moves system cursor to target position via `SetCursorPos` before sending asynchronous messages. Designed for games like Genshin Impact that detect actual mouse position, can control in background, same UIPI/permission restrictions apply. |

### Win32 Screencap

> Reference: [MaaDef.h](https://github.com/MaaXYZ/MaaFramework/blob/main/include/MaaFramework/MaaDef.h#L242-L250)

Select one of the values below.

No default value. Client can choose one as the default.

Different programs on Win32 handle rendering differently, so there is no universal method.

| Name | Value | Description |
| --- | --- | --- |
| GDI | `1` | Capture via window `HDC`/`BitBlt`; may be affected by DWM/rendering path for some programs/occlusion scenarios. |
| FramePool | `2` | Windows Graphics Capture (`Direct3D11CaptureFramePool`); typically supports background capture for occluded windows, available on Windows 10 1903+. |
| DXGI_DesktopDup | `4` | Desktop duplication (full-screen output copy); does not support background window capture (will include occluded content/desktop frames only). |
| DXGI_DesktopDup_Window | `8` | Desktop duplication cropped to window client area; same as `DXGI_DesktopDup`, occlusion affects results. |
| PrintWindow | `16` | Uses `PrintWindow` for capture; supports non-minimized background windows, some programs/layered windows may be incompatible. |
| ScreenDC | `32` | Captures from screen DC based on window client area rectangle; fully affected by occlusion, does not support background capture. |
