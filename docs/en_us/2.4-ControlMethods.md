# 2.4 Control Methods

This document provides detailed explanations of the various Screencap (screenshot) and Input (control) methods in MaaFramework and their configurations.

> [!TIP]
>
> - For APIs, screencap/input uses `int` type (bitwise OR combination); for [ProjectInterface V2](3.3-ProjectInterfaceV2.md), use `string` type (use the name directly).
> - [ProjectInterface V2](3.3-ProjectInterfaceV2.md) only supports configuring screencap/mouse/keyboard methods for Win32 controllers. For Adb controllers, screencap/input uses `MaaToolkitAdbDeviceFind` to automatically detect and select the optimal method, no manual configuration required.

## Adb

### Adb Input

> Reference: [MaaDef.h](https://github.com/MaaXYZ/MaaFramework/blob/main/include/MaaFramework/MaaDef.h#L227-L240)

Combine the selected methods below using **bitwise OR** to provide a single value. MaaFramework will try all provided methods in a fixed priority order and select the first available method.

By default, all methods except EmulatorExtras are attempted.

> Priority: EmulatorExtras > Maatouch > MinitouchAndAdbKey > AdbShell

| Name | API Value | Speed | Compatibility | Description |
| --- | --- | --- | --- | --- |
| AdbShell | `1` | Slow | High |  |
| MinitouchAndAdbKey | `2` | Fast | Medium | Key input still uses AdbShell |
| Maatouch | `4` | Fast | Medium |  |
| EmulatorExtras | `8` | Fast | Low | Only supports emulators: MuMu 12 |

### Adb Screencap

> Reference: [MaaDef.h](https://github.com/MaaXYZ/MaaFramework/blob/main/include/MaaFramework/MaaDef.h#L208-L225)

Combine the selected methods below using **bitwise OR** to provide a single value. MaaFramework will try all provided methods and select the fastest available method.

By default, all methods except `RawByNetcat`, `MinicapDirect`, and `MinicapStream` are attempted.

`MinicapDirect` and `MinicapStream` encode to jpg (lossy compression), which significantly reduces template matching effectiveness and are not recommended.

| Name | API Value | Speed | Compatibility | Encoding | Description |
| --- | --- | --- | --- | --- | --- |
| EncodeToFileAndPull | `1` | Slow | High | Lossless |  |
| Encode | `2` | Slow | High | Lossless |  |
| RawWithGzip | `4` | Medium | High | Lossless |  |
| RawByNetcat | `8` | Fast | Low | Lossless |  |
| MinicapDirect | `16` | Fast | Low | Lossy |  |
| MinicapStream | `32` | Very Fast | Low | Lossy |  |
| EmulatorExtras | `64` | Very Fast | Low | Lossless | Only supports emulators: MuMu 12, LDPlayer 9 |

## Win32

### Win32 Input

> Reference: [MaaDef.h](https://github.com/MaaXYZ/MaaFramework/blob/main/include/MaaFramework/MaaDef.h#L252-L259)

Select one of the values below.

No default value. Client can choose one as the default.

Different programs on Win32 handle input differently, so there is no universal method.

| Name | API Value | Compatibility | Requires Admin | Seizes Cursor | Background | Description |
| --- | --- | --- | --- | --- | --- | --- |
| Seize | `1` | High | No | Yes | No |  |
| SendMessage | `2` | Medium | Maybe | No | Yes |  |
| PostMessage | `4` | Medium | Maybe | No | Yes |  |
| LegacyEvent | `8` | Low | No | Yes | No |  |
| PostThreadMessage | `16` | Low | Maybe | No | Yes |  |
| SendMessageWithCursorPos | `32` | Medium | Maybe | Brief | Yes | Designed for games like Genshin Impact that detect actual mouse position |
| PostMessageWithCursorPos | `64` | Medium | Maybe | Brief | Yes | Designed for games like Genshin Impact that detect actual mouse position |
| Gamepad | `128` | Low | No | No | Yes | Simulates virtual Xbox 360 gamepad, requires [ViGEmBus](https://github.com/nefarius/ViGEmBus/releases) driver |

> [!NOTE]
>
> - Admin privileges mainly depend on the target program's permission level. If the target program runs as administrator, running with admin privileges is required for compatibility.
> - The `WithCursorPos` methods briefly move the cursor to the target position, then restore it after sending the message, hence "Brief" cursor seizure, but it does not block user operations.

### Win32 Screencap

> Reference: [MaaDef.h](https://github.com/MaaXYZ/MaaFramework/blob/main/include/MaaFramework/MaaDef.h#L242-L250)

Select one of the values below.

No default value. Client can choose one as the default.

Different programs on Win32 handle rendering differently, so there is no universal method.

| Name | API Value | Speed | Compatibility | Requires Admin | Background | Description |
| --- | --- | --- | --- | --- | --- | --- |
| GDI | `1` | Fast | Medium | No | No |  |
| FramePool | `2` | Very Fast | Medium | No | Yes | Available on Windows 10 1903+ |
| DXGI_DesktopDup | `4` | Very Fast | Low | No | No | Desktop duplication (full-screen output copy) |
| DXGI_DesktopDup_Window | `8` | Very Fast | Low | No | No | Desktop duplication cropped to window |
| PrintWindow | `16` | Medium | Medium | No | Yes |  |
| ScreenDC | `32` | Fast | High | No | No |  |

> [!NOTE]
>
> Windows stops rendering window content when the window is minimized. All screenshot methods cannot capture valid content from minimized windows, so please avoid minimizing the window.

## Gamepad (Windows)

The Gamepad controller is used to simulate a virtual Xbox 360 gamepad, suitable for controlling games that support gamepad input.

### Usage

```cpp
// C API
auto controller = MaaGamepadControllerCreate(hWnd, MaaWin32ScreencapMethod_GDI);
```

### Parameters

| Parameter | Description |
| --- | --- |
| hWnd | Window handle |
| screencap_method | Screenshot method, see [Win32 Screencap](#win32-screencap) |

### Supported Features

| Feature | Supported | Description |
| --- | --- | --- |
| Screenshot (screencap) | ✓ | Uses Win32 screenshot method |
| Click (click) | ✗ | Gamepad does not support mouse clicks |
| Swipe (swipe) | ✗ | Gamepad does not support swipe |
| Touch (touch_down/move/up) | ✓ | Mapped to sticks/triggers, see table below |
| Key Down (key_down) | ✓ | Simulates gamepad button press |
| Key Up (key_up) | ✓ | Simulates gamepad button release |
| Stop App (stop_app) | ✗ | Gamepad does not support |
| Start App (start_app) | ✗ | Gamepad does not support |
| Text Input (input_text) | ✗ | Gamepad does not support |
| Scroll (scroll) | ✗ | Gamepad does not support |

### Touch Operation Mapping

Touch operations are mapped to different gamepad controls via the `contact` parameter:

| contact | Mapped Control | Parameter Description |
| --- | --- | --- |
| 0 | Left Stick | `x`: X-axis (-32768~32767), `y`: Y-axis (-32768~32767) |
| 1 | Right Stick | `x`: X-axis (-32768~32767), `y`: Y-axis (-32768~32767) |
| 2 | Left Trigger | `pressure`: Trigger pressure (0~255) |
| 3 | Right Trigger | `pressure`: Trigger pressure (0~255) |

### Key Codes

Key operations use XUSB key codes. Common keys are listed below:

| Key | Value | Description |
| --- | --- | --- |
| XUSB_GAMEPAD_DPAD_UP | 0x0001 | D-Pad Up |
| XUSB_GAMEPAD_DPAD_DOWN | 0x0002 | D-Pad Down |
| XUSB_GAMEPAD_DPAD_LEFT | 0x0004 | D-Pad Left |
| XUSB_GAMEPAD_DPAD_RIGHT | 0x0008 | D-Pad Right |
| XUSB_GAMEPAD_START | 0x0010 | Start Button |
| XUSB_GAMEPAD_BACK | 0x0020 | Back Button |
| XUSB_GAMEPAD_LEFT_THUMB | 0x0040 | Left Stick Press |
| XUSB_GAMEPAD_RIGHT_THUMB | 0x0080 | Right Stick Press |
| XUSB_GAMEPAD_LEFT_SHOULDER | 0x0100 | Left Shoulder (LB) |
| XUSB_GAMEPAD_RIGHT_SHOULDER | 0x0200 | Right Shoulder (RB) |
| XUSB_GAMEPAD_A | 0x1000 | A Button |
| XUSB_GAMEPAD_B | 0x2000 | B Button |
| XUSB_GAMEPAD_X | 0x4000 | X Button |
| XUSB_GAMEPAD_Y | 0x8000 | Y Button |

### Prerequisites

1. Install [ViGEmBus](https://github.com/nefarius/ViGEmBus/releases) driver
2. Ensure `ViGEmClient.dll` is in the same directory as the program or in the system path

> [!NOTE]
>
> - The Gamepad controller's feature flag is `MaaControllerFeature_UseKeyboardDownAndUpInsteadOfClick`, indicating that the framework will use key_down + key_up instead of click_key operations.
> - The gamepad controller supports background operation, so input can be sent without the window being in the foreground.

## PlayCover (macOS)

The PlayCover controller is used to control iOS applications running via [fork PlayCover](https://github.com/hguandl/PlayCover/releases) on macOS.

### Usage

```cpp
// C API
auto controller = MaaPlayCoverControllerCreate("127.0.0.1:1717", "com.example.app");
```

```python
# Python
from maa.controller import PlayCoverController
controller = PlayCoverController("127.0.0.1:1717", "com.example.app")
```

```typescript
// NodeJS
const controller = new maa.PlayCoverController("127.0.0.1:1717", "com.example.app")
```

### Parameters

| Parameter | Description |
| --- | --- |
| address | PlayTools service listening address, format: `host:port`, e.g., `127.0.0.1:1717` |
| uuid | Target application's Bundle Identifier, e.g., `com.hypergryph.arknights` |

### Supported Features

| Feature | Supported | Description |
| --- | --- | --- |
| Screenshot (screencap) | ✓ | Retrieves RGBA raw data via PlayTools protocol |
| Click (click) | ✓ | Implemented using touch_down + touch_up |
| Swipe (swipe) | ✓ | Smooth trajectory using cubic spline interpolation |
| Touch (touch_down/move/up) | ✓ | Single touch only (contact=0) |
| Stop App (stop_app) | ✓ | Sends terminate command |
| Start App (start_app) | ✗ | PlayCover does not support launching apps via protocol |
| Key Press (click_key/key_down/key_up) | ✗ | Not supported by PlayTools protocol |
| Text Input (input_text) | ✗ | Not supported by PlayTools protocol |
| Scroll (scroll) | ✗ | Not supported by PlayTools protocol |

### Prerequisites

1. Install [fork PlayCover](https://github.com/hguandl/PlayCover/releases) on macOS
2. Target iOS app must have MaaTools feature enabled in PlayCover

> [!NOTE]
>
> The PlayCover controller's feature flag is `MaaControllerFeature_UseMouseDownAndUpInsteadOfClick`, indicating that the framework will use touch_down + touch_up instead of click operations.
