{
    "$schema": "http://json-schema.org/draft-07/schema#",
    "title": "MaaFramework Project Interface V2",
    "description": "MaaFramework 项目接口配置文件 V2 版本的 JSON Schema",
    "type": "object",
    "definitions": {
        "i18nString": {
            "type": "string",
            "description": "支持国际化的字符串，以 $ 开头表示从翻译文件中读取"
        },
        "pipelineOverride": {
            "type": "object",
            "title": "Pipeline 覆盖配置",
            "description": "用于覆盖已加载资源中的 pipeline 配置",
            "additionalProperties": true
        },
        "caseItem": {
            "type": "object",
            "title": "选项项",
            "properties": {
                "name": {
                    "type": "string",
                    "title": "选项唯一标识符",
                    "description": "用作选项 ID"
                },
                "label": {
                    "$ref": "#/definitions/i18nString",
                    "title": "显示名称",
                    "description": "用于在用户界面中展示，支持国际化。如果未设置，则显示 name 字段的值"
                },
                "description": {
                    "$ref": "#/definitions/i18nString",
                    "title": "详细描述",
                    "description": "支持文件路径、URL 或直接文本，内容支持 Markdown 格式"
                },
                "icon": {
                    "$ref": "#/definitions/i18nString",
                    "title": "图标路径",
                    "description": "选项图标文件路径，相对于项目根目录"
                },
                "option": {
                    "type": "array",
                    "title": "子配置项列表",
                    "description": "只有当用户选中当前选项时，才会显示这些子配置项。这些子配置项同样放在外层的 option 中定义，支持无限嵌套",
                    "items": {
                        "type": "string"
                    }
                },
                "pipeline_override": {
                    "$ref": "#/definitions/pipelineOverride",
                    "title": "Pipeline 覆盖",
                    "description": "在选项激活时生效的 pipeline 配置覆盖"
                }
            },
            "required": [
                "name"
            ],
            "additionalProperties": false
        },
        "inputItem": {
            "type": "object",
            "title": "输入字段",
            "properties": {
                "name": {
                    "type": "string",
                    "title": "输入字段唯一标识符",
                    "description": "用作输入字段 ID"
                },
                "label": {
                    "$ref": "#/definitions/i18nString",
                    "title": "显示名称",
                    "description": "用于在用户界面中展示，支持国际化。如果未设置，则显示 name 字段的值"
                },
                "description": {
                    "$ref": "#/definitions/i18nString",
                    "title": "详细描述",
                    "description": "帮助用户理解输入要求。支持文件路径、URL 或直接文本，内容支持 Markdown 格式"
                },
                "default": {
                    "type": "string",
                    "title": "默认值",
                    "description": "输入字段的默认值"
                },
                "pipeline_type": {
                    "type": "string",
                    "title": "Pipeline 数据类型",
                    "description": "输入字段在 pipeline_override 中的数据类型，用于类型转换",
                    "enum": [
                        "string",
                        "int",
                        "bool"
                    ]
                },
                "verify": {
                    "type": "string",
                    "title": "校验正则表达式",
                    "description": "用于校验用户输入是否合法的正则表达式"
                },
                "pattern_msg": {
                    "$ref": "#/definitions/i18nString",
                    "title": "校验错误信息",
                    "description": "正则校验用户输入错误时显示的信息"
                }
            },
            "required": [
                "name"
            ],
            "additionalProperties": false
        },
        "optionDefinition": {
            "type": "object",
            "title": "配置项定义",
            "oneOf": [
                {
                    "title": "inputOption",
                    "type": "object",
                    "properties": {
                        "type": {
                            "const": "input",
                            "description": "用户输入框，允许用户手动输入内容"
                        },
                        "label": {
                            "$ref": "#/definitions/i18nString",
                            "title": "显示标签",
                            "description": "用于在用户界面中展示，支持国际化"
                        },
                        "description": {
                            "$ref": "#/definitions/i18nString",
                            "title": "详细描述",
                            "description": "帮助用户理解配置项的作用。支持文件路径、URL 或直接文本，内容支持 Markdown 格式"
                        },
                        "icon": {
                            "$ref": "#/definitions/i18nString",
                            "title": "图标路径",
                            "description": "配置项图标文件路径，相对于项目根目录"
                        },
                        "inputs": {
                            "type": "array",
                            "title": "输入配置",
                            "description": "定义用户可输入的字段",
                            "items": {
                                "$ref": "#/definitions/inputItem"
                            }
                        },
                        "pipeline_override": {
                            "$ref": "#/definitions/pipelineOverride",
                            "title": "Pipeline 覆盖模板",
                            "description": "支持使用「名称」格式引用输入字段的值"
                        }
                    },
                    "required": [
                        "type",
                        "inputs"
                    ],
                    "additionalProperties": false
                },
                {
                    "title": "selectOption",
                    "type": "object",
                    "properties": {
                        "type": {
                            "const": "select",
                            "description": "下拉选项框，用户从预定义的选项中选择"
                        },
                        "label": {
                            "$ref": "#/definitions/i18nString",
                            "title": "显示标签",
                            "description": "用于在用户界面中展示，支持国际化"
                        },
                        "description": {
                            "$ref": "#/definitions/i18nString",
                            "title": "详细描述",
                            "description": "帮助用户理解配置项的作用。支持文件路径、URL 或直接文本，内容支持 Markdown 格式"
                        },
                        "icon": {
                            "$ref": "#/definitions/i18nString",
                            "title": "图标路径",
                            "description": "配置项图标文件路径，相对于项目根目录"
                        },
                        "cases": {
                            "type": "array",
                            "title": "可选项列表",
                            "items": {
                                "$ref": "#/definitions/caseItem"
                            }
                        },
                        "default_case": {
                            "type": "string",
                            "title": "默认选项",
                            "description": "默认选项名称"
                        }
                    },
                    "required": [
                        "cases"
                    ],
                    "additionalProperties": false
                },
                {
                    "title": "switchOption",
                    "type": "object",
                    "properties": {
                        "type": {
                            "const": "switch",
                            "description": "选择框，Yes or No"
                        },
                        "label": {
                            "$ref": "#/definitions/i18nString",
                            "title": "显示标签",
                            "description": "用于在用户界面中展示，支持国际化"
                        },
                        "description": {
                            "$ref": "#/definitions/i18nString",
                            "title": "详细描述",
                            "description": "帮助用户理解配置项的作用。支持文件路径、URL 或直接文本，内容支持 Markdown 格式"
                        },
                        "icon": {
                            "$ref": "#/definitions/i18nString",
                            "title": "图标路径",
                            "description": "配置项图标文件路径，相对于项目根目录"
                        },
                        "cases": {
                            "type": "array",
                            "title": "可选项列表",
                            "description": "仅支持两个 cases。case.name 应为 Yes/yes/Y/y 或 No/no/N/n 之一，建议使用 Yes 和 No",
                            "minItems": 2,
                            "maxItems": 2,
                            "items": {
                                "$ref": "#/definitions/caseItem"
                            }
                        },
                        "default_case": {
                            "type": "string",
                            "title": "默认选项",
                            "description": "默认选项名称，应为 Yes 或 No"
                        }
                    },
                    "required": [
                        "cases"
                    ],
                    "additionalProperties": false
                }
            ]
        },
        "controllerItem": {
            "type": "object",
            "title": "控制器配置",
            "properties": {
                "name": {
                    "type": "string",
                    "title": "唯一名称标识符",
                    "description": "用作控制器 ID"
                },
                "label": {
                    "$ref": "#/definitions/i18nString",
                    "title": "显示名称",
                    "description": "用于在用户界面中展示，支持国际化。如果未设置，则显示 name 字段的值"
                },
                "description": {
                    "$ref": "#/definitions/i18nString",
                    "title": "详细描述",
                    "description": "支持文件路径、URL 或直接文本，内容支持 Markdown 格式"
                },
                "icon": {
                    "$ref": "#/definitions/i18nString",
                    "title": "图标路径",
                    "description": "控制器图标文件路径，相对于项目根目录"
                },
                "type": {
                    "type": "string",
                    "title": "控制器类型",
                    "enum": [
                        "Adb",
                        "Win32",
                        "PlayCover",
                        "Gamepad"
                    ]
                },
                "display_short_side": {
                    "type": "number",
                    "title": "短边分辨率",
                    "description": "默认缩放分辨率的短边长度，用于屏幕适配。与 display_long_side 和 display_raw 互斥",
                    "default": 720
                },
                "display_long_side": {
                    "type": "number",
                    "title": "长边分辨率",
                    "description": "默认缩放分辨率的长边长度，用于屏幕适配。与 display_short_side 和 display_raw 互斥"
                },
                "display_raw": {
                    "type": "boolean",
                    "title": "使用原始分辨率",
                    "description": "是否使用原始分辨率进行截图，不进行缩放。与缩放分辨率设置互斥",
                    "default": false
                },
                "permission_required": {
                    "type": "boolean",
                    "title": "需要管理员权限",
                    "description": "该控制器是否需要以管理员权限运行（例如某些 Win32 输入方式需要更高权限）。不设置则默认为 false",
                    "default": false
                },
                "attach_resource_path": {
                    "type": "array",
                    "title": "附加资源路径",
                    "description": "可选。附加资源路径数组。将会在 resource.path 加载完成后，额外加载这些路径下的资源",
                    "items": {
                        "type": "string"
                    }
                },
                "adb": {
                    "type": "object",
                    "title": "Adb 控制器配置",
                    "description": "Adb 控制器的具体配置。V2 协议中 input/screencap 由 MaaFramework 自动检测，无需手动配置",
                    "additionalProperties": true
                },
                "win32": {
                    "type": "object",
                    "title": "Win32 控制器配置",
                    "description": "Win32 控制器的具体配置",
                    "properties": {
                        "class_regex": {
                            "type": "string",
                            "title": "窗口类名正则",
                            "description": "可选。Win32 控制器搜索窗口类名使用的正则表达式"
                        },
                        "window_regex": {
                            "type": "string",
                            "title": "窗口标题正则",
                            "description": "可选。Win32 控制器搜索窗口标题使用的正则表达式"
                        },
                        "mouse": {
                            "type": "string",
                            "title": "鼠标控制方式",
                            "description": "可选。Win32 控制器的鼠标控制方式，不提供则使用默认",
                            "enum": [
                                "Seize",
                                "SendMessage",
                                "PostMessage",
                                "LegacyEvent",
                                "PostThreadMessage",
                                "SendMessageWithCursorPos",
                                "PostMessageWithCursorPos"
                            ]
                        },
                        "keyboard": {
                            "type": "string",
                            "title": "键盘控制方式",
                            "description": "可选。Win32 控制器的键盘控制方式，不提供则使用默认",
                            "enum": [
                                "Seize",
                                "SendMessage",
                                "PostMessage",
                                "LegacyEvent",
                                "PostThreadMessage",
                                "SendMessageWithCursorPos",
                                "PostMessageWithCursorPos"
                            ]
                        },
                        "screencap": {
                            "type": "string",
                            "title": "截图方式",
                            "description": "可选。Win32 控制器的截图方式，不提供则使用默认",
                            "enum": [
                                "GDI",
                                "FramePool",
                                "DXGI_DesktopDup",
                                "DXGI_DesktopDup_Window",
                                "PrintWindow",
                                "ScreenDC"
                            ]
                        }
                    },
                    "additionalProperties": false
                },
                "playcover": {
                    "type": "object",
                    "title": "PlayCover 控制器配置",
                    "description": "PlayCover 控制器的具体配置（仅 macOS）",
                    "properties": {
                        "uuid": {
                            "type": "string",
                            "title": "Bundle Identifier",
                            "description": "可选。目标应用的 Bundle Identifier，不提供则使用默认 maa.playcover，仅作为控制器标识符，与被操控应用无关",
                            "examples": [
                                "com.hypergryph.arknights"
                            ]
                        }
                    },
                    "additionalProperties": false
                },
                "gamepad": {
                    "type": "object",
                    "title": "Gamepad 控制器配置",
                    "description": "虚拟游戏手柄控制器的具体配置（仅 Windows）。需要安装 ViGEm Bus Driver",
                    "properties": {
                        "class_regex": {
                            "type": "string",
                            "title": "窗口类名正则",
                            "description": "可选。搜索窗口类名使用的正则表达式，用于截图功能"
                        },
                        "window_regex": {
                            "type": "string",
                            "title": "窗口标题正则",
                            "description": "可选。搜索窗口标题使用的正则表达式，用于截图功能"
                        },
                        "gamepad_type": {
                            "type": "string",
                            "title": "手柄类型",
                            "description": "可选。虚拟手柄类型，不提供则默认使用 Xbox360",
                            "enum": [
                                "Xbox360",
                                "DualShock4",
                                "DS4"
                            ],
                            "default": "Xbox360"
                        },
                        "screencap": {
                            "type": "string",
                            "title": "截图方式",
                            "description": "可选。截图方式，不提供则使用默认。仅当配置了窗口正则时有效",
                            "enum": [
                                "GDI",
                                "FramePool",
                                "DXGI_DesktopDup",
                                "DXGI_DesktopDup_Window",
                                "PrintWindow",
                                "ScreenDC"
                            ]
                        }
                    },
                    "additionalProperties": false
                }
            },
            "required": [
                "name",
                "type"
            ],
            "additionalProperties": false
        },
        "resourceItem": {
            "type": "object",
            "title": "资源配置",
            "properties": {
                "name": {
                    "type": "string",
                    "title": "唯一名称标识符",
                    "description": "用作资源包 ID"
                },
                "label": {
                    "$ref": "#/definitions/i18nString",
                    "title": "显示名称",
                    "description": "用于在用户界面中展示，支持国际化。如果未设置，则显示 name 字段的值"
                },
                "description": {
                    "$ref": "#/definitions/i18nString",
                    "title": "详细描述",
                    "description": "支持文件路径、URL 或直接文本，内容支持 Markdown 格式"
                },
                "icon": {
                    "$ref": "#/definitions/i18nString",
                    "title": "图标路径",
                    "description": "资源图标文件路径，相对于项目根目录"
                },
                "path": {
                    "type": "array",
                    "title": "资源路径",
                    "description": "加载的路径数组。如果提供多个路径，会依次加载，后加载的资源会覆盖前加载的资源。文件相对路径为 interface.json 同目录下的相对路径",
                    "items": {
                        "type": "string"
                    }
                },
                "controller": {
                    "type": "array",
                    "title": "支持的控制器",
                    "description": "指定该资源包支持的控制器类型列表。数组元素应与 controller 配置中的 name 字段对应。若不指定，则表示支持所有控制器类型",
                    "items": {
                        "type": "string"
                    }
                },
                "option": {
                    "type": "array",
                    "title": "全局选项配置",
                    "description": "可选。资源包的全局选项配置，为一个字符串数组，数组元素应与外层 option 配置中的键名对应。该选项生成的参数会参与到所有任务的 pipeline override 中",
                    "items": {
                        "type": "string"
                    }
                }
            },
            "required": [
                "name",
                "path"
            ],
            "additionalProperties": false
        },
        "taskItem": {
            "type": "object",
            "title": "任务配置",
            "properties": {
                "name": {
                    "type": "string",
                    "title": "任务唯一标识符",
                    "description": "用作任务 ID"
                },
                "label": {
                    "$ref": "#/definitions/i18nString",
                    "title": "显示名称",
                    "description": "用于在用户界面中展示，支持国际化。如果未设置，则显示 name 字段的值"
                },
                "entry": {
                    "type": "string",
                    "title": "任务入口",
                    "description": "为 pipeline 中 Task 的名称"
                },
                "default_check": {
                    "type": "boolean",
                    "title": "默认选中",
                    "description": "是否默认选中该任务。Client 在初始化时会根据该值决定是否默认勾选该任务",
                    "default": false
                },
                "description": {
                    "$ref": "#/definitions/i18nString",
                    "title": "详细描述",
                    "description": "帮助用户理解任务功能。支持文件路径、URL 或直接文本，内容支持 Markdown 格式"
                },
                "doc": {
                    "anyOf": [
                        {
                            "$ref": "#/definitions/i18nString"
                        },
                        {
                            "type": "array",
                            "items": {
                                "$ref": "#/definitions/i18nString"
                            }
                        }
                    ],
                    "title": "任务文档",
                    "description": "任务的详细文档说明，支持字符串或字符串数组"
                },
                "icon": {
                    "$ref": "#/definitions/i18nString",
                    "title": "图标路径",
                    "description": "任务图标文件路径，相对于项目根目录"
                },
                "resource": {
                    "type": "array",
                    "title": "支持的资源包",
                    "description": "指定该任务支持的资源包列表。数组元素应与 resource 配置中的 name 字段对应。若不指定，则表示该任务在所有资源包中都可用",
                    "items": {
                        "type": "string"
                    }
                },
                "controller": {
                    "type": "array",
                    "title": "支持的控制器",
                    "description": "指定该任务支持的控制器类型列表。数组元素应与 controller 配置中的 name 字段对应。若不指定，则表示该任务在所有控制器类型中都可用",
                    "items": {
                        "type": "string"
                    }
                },
                "pipeline_override": {
                    "$ref": "#/definitions/pipelineOverride",
                    "title": "Pipeline 覆盖",
                    "description": "执行任务时会覆盖已加载的资源"
                },
                "option": {
                    "type": "array",
                    "title": "任务配置项",
                    "description": "包含若干 option 对象中的键的值，Client 会根据要求让用户进行选择",
                    "items": {
                        "type": "string"
                    }
                }
            },
            "required": [
                "name",
                "entry"
            ],
            "additionalProperties": false
        },
        "agentConfig": {
            "type": "object",
            "title": "代理配置",
            "description": "包含子进程（AgentServer）的信息",
            "properties": {
                "child_exec": {
                    "type": "string",
                    "title": "子进程路径",
                    "description": "子进程路径，为系统路径中可执行文件。如在环境变量中存在 Python 路径，可直接写 python。CWD 为 interface.json 所在目录"
                },
                "child_args": {
                    "type": "array",
                    "title": "子进程参数",
                    "description": "子进程参数数组",
                    "items": {
                        "type": "string"
                    }
                },
                "identifier": {
                    "type": "string",
                    "title": "连接标识符",
                    "description": "被用来创建一个通信套接字。填写则会被使用，否则自动创建"
                }
            },
            "required": [
                "child_exec"
            ],
            "additionalProperties": false
        }
    },
    "properties": {
        "interface_version": {
            "type": "number",
            "title": "接口版本号",
            "description": "当前为 2，固定且必须设置。用于标识 ProjectInterface 协议版本",
            "const": 2
        },
        "languages": {
            "type": "object",
            "title": "多语言支持配置",
            "description": "键为语言代码，值为对应的翻译文件路径。文件相对路径为 interface.json 同目录下的相对路径",
            "additionalProperties": {
                "type": "string"
            },
            "examples": [
                {
                    "zh_cn": "interface_zh.json",
                    "en_us": "interface_en.json"
                }
            ]
        },
        "name": {
            "type": "string",
            "title": "项目唯一标识符",
            "description": "用作项目 ID"
        },
        "label": {
            "$ref": "#/definitions/i18nString",
            "title": "项目显示名称",
            "description": "用于在用户界面中展示，支持国际化。如果未设置，则显示 name 字段的值"
        },
        "title": {
            "$ref": "#/definitions/i18nString",
            "title": "窗口标题",
            "description": "Client 会直接显示该内容，不添加其他修饰。默认使用 name 和 version 拼接生成"
        },
        "icon": {
            "$ref": "#/definitions/i18nString",
            "title": "应用图标",
            "description": "应用图标文件路径，相对于项目根目录。若不指定，则使用默认图标"
        },
        "mirrorchyan_rid": {
            "type": "string",
            "title": "MirrorChyan 资源包标识符",
            "description": "用于资源管理和分发"
        },
        "mirrorchyan_multiplatform": {
            "type": "boolean",
            "title": "多平台支持",
            "description": "是否支持多平台，影响资源包的打包和分发策略"
        },
        "github": {
            "type": "string",
            "title": "GitHub 仓库地址",
            "description": "项目 GitHub 仓库地址，用于版本更新检查和问题反馈",
            "format": "uri"
        },
        "version": {
            "type": "string",
            "title": "项目版本号",
            "description": "Client 可以展示给用户，同时用于版本更新检查"
        },
        "contact": {
            "$ref": "#/definitions/i18nString",
            "title": "联系方式",
            "description": "显示在「关于」页面。支持文件路径、URL 或直接文本，内容支持 Markdown 格式"
        },
        "license": {
            "$ref": "#/definitions/i18nString",
            "title": "许可证信息",
            "description": "显示在「关于」页面。支持文件路径、URL 或直接文本，内容支持 Markdown 格式"
        },
        "welcome": {
            "$ref": "#/definitions/i18nString",
            "title": "欢迎消息",
            "description": "在用户首次使用时弹窗显示，亦可作为公告使用。支持文件路径、URL 或直接文本，内容支持 Markdown 格式。系统会记录显示内容，当内容更新时会再次弹窗显示"
        },
        "description": {
            "$ref": "#/definitions/i18nString",
            "title": "项目描述",
            "description": "显示在「关于」页面。支持文件路径、URL 或直接文本，内容支持 Markdown 格式"
        },
        "controller": {
            "type": "array",
            "title": "控制器配置",
            "description": "为一个对象数组，包含预设的控制器信息",
            "items": {
                "$ref": "#/definitions/controllerItem"
            }
        },
        "resource": {
            "type": "array",
            "title": "资源配置",
            "description": "为一个对象数组，包含资源加载的信息",
            "items": {
                "$ref": "#/definitions/resourceItem"
            }
        },
        "agent": {
            "oneOf": [
                {
                    "$ref": "#/definitions/agentConfig"
                },
                {
                    "type": "array",
                    "title": "代理配置数组",
                    "description": "多个子进程（AgentServer）的配置",
                    "items": {
                        "$ref": "#/definitions/agentConfig"
                    }
                }
            ]
        },
        "task": {
            "type": "array",
            "title": "任务配置",
            "description": "为一个对象数组，包含可执行任务的信息",
            "items": {
                "$ref": "#/definitions/taskItem"
            }
        },
        "option": {
            "type": "object",
            "title": "配置项定义",
            "description": "为一个对象映射，包含配置项的信息",
            "additionalProperties": {
                "$ref": "#/definitions/optionDefinition"
            }
        },
        "import": {
            "type": "array",
            "title": "导入其他 PI 文件",
            "description": "可选。导入其他 PI 文件的路径数组。文件相对路径为 interface.json 同目录下的相对路径。仅支持导入这些文件中的 task 和 option 字段",
            "items": {
                "type": "string"
            }
        }
    },
    "required": [
        "interface_version",
        "name",
        "controller",
        "resource",
        "task"
    ],
    "additionalProperties": false
}
