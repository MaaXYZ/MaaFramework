{
    "$schema": "https://json-schema.org/draft-07/schema",
    "type": "object",
    "patternProperties": {
        "^(?!.*?\\$schema).*$": {
            "type": "object",
            "patternProperties": {
                ".*_doc$|^doc$": {
                    "type": "string"
                },
                ".*_code$|^code$": {
                    "type": "string"
                }
            },
            "properties": {
                "recognition": {
                    "description": "识别算法类型。可选，默认 DirectHit。",
                    "enum": [
                        "DirectHit",
                        "TemplateMatch",
                        "FeatureMatch",
                        "ColorMatch",
                        "OCR",
                        "NeuralNetworkClassify",
                        "NeuralNetworkDetect",
                        "Custom"
                    ],
                    "default": "DirectHit"
                },
                "action": {
                    "description": "执行的动作。可选，默认 DoNothing。",
                    "enum": [
                        "DoNothing",
                        "Click",
                        "Swipe",
                        "MultiSwipe",
                        "Key",
                        "InputText",
                        "Text",
                        "StartApp",
                        "StopApp",
                        "StopTask",
                        "Command",
                        "Custom"
                    ],
                    "default": "DoNothing"
                },
                "next": {
                    "description": "接下来要执行的任务列表。可选，默认空。\n按序识别每个任务，只执行第一个识别到的。",
                    "$ref": "#/definitions/tasklist"
                },
                "interrupt": {
                    "description": "`next` 中全部未识别到时的候补任务列表，会执行类似中断操作。\n按序识别每个任务，只执行第一个识别到的。",
                    "$ref": "#/definitions/tasklist"
                },
                "on_error": {
                    "description": "当 `next` 识别完全失败，或动作执行失败后，接下来会执行该列表中的任务\n按序识别每个任务，只执行第一个识别到的。",
                    "$ref": "#/definitions/tasklist"
                },
                "is_sub": {
                    "description": "已废弃字段！\n是否是子任务。可选，默认否。\n若是，该任务在任意列表中行为均与 interrupt 中一致",
                    "type": "boolean",
                    "default": false
                },
                "inverse": {
                    "description": "反转识别结果，识别到了当做没识别到，没识别到的当做识别到了。可选，默认否。",
                    "type": "boolean",
                    "default": false
                },
                "enabled": {
                    "description": "是否启用该 task。可选，默认 true",
                    "type": "boolean",
                    "default": true
                },
                "rate_limit": {
                    "description": "识别速率限制，单位毫秒。\n每轮识别 next 最低消耗 `rate_limit` 毫秒，不足的时间将会 sleep 等待。",
                    "type": "integer",
                    "minimum": 0,
                    "default": 1000
                },
                "timeout": {
                    "description": "`next` + `interrupt` 识别超时时间，毫秒。默认 20 * 1000 。\n具体逻辑为 `while(!timeout) { foreach(next + interrupt); sleep_until(rate_limit); }` 。",
                    "type": "integer",
                    "minimum": 0,
                    "default": 20000
                },
                "pre_delay": {
                    "description": "识别到 到 执行动作前 的延迟，毫秒。可选，默认 200。\n推荐尽可能增加中间过程任务，少用延迟，不然既慢还不稳定。",
                    "type": "integer",
                    "minimum": 0,
                    "default": 200
                },
                "post_delay": {
                    "description": "执行动作后 到 下一个步骤 的延迟，毫秒。可选，默认 200。\n推荐尽可能增加中间过程任务，少用延迟，不然既慢还不稳定。",
                    "type": "integer",
                    "minimum": 0,
                    "default": 200
                },
                "pre_wait_freezes": {
                    "description": "识别到 到 执行动作前，等待画面不动了的时间，毫秒。可选，默认 0，即不等待。",
                    "$ref": "#/definitions/wait_freezes_type"
                },
                "post_wait_freezes": {
                    "description": "行动动作后 到 识别 next，等待画面不动了的时间，毫秒。可选，默认 0，即不等待。",
                    "$ref": "#/definitions/wait_freezes_type"
                },
                "focus": {
                    "description": "同步回调消息。可选，默认 null，不产生。",
                    "default": null
                },
                "roi": {
                    "description": "识别区域坐标。可选，默认 [0, 0, 0, 0]，即全屏。",
                    "$ref": "#/definitions/roi_type",
                    "default": [
                        0,
                        0,
                        0,
                        0
                    ]
                },
                "roi_offset": {
                    "description": "在 roi_offset 的基础上额外移动再作为目标，四个值分别相加。可选，默认 [0, 0, 0, 0]。",
                    "$ref": "#/definitions/rect",
                    "default": [
                        0,
                        0,
                        0,
                        0
                    ]
                },
                "order_by": {
                    "description": "识别结果排序方式。可选，默认 `Horizontal`",
                    "enum": [
                        "Horizontal",
                        "Vertical",
                        "Score",
                        "Area",
                        "Length",
                        "Random",
                        "Excepted"
                    ],
                    "default": "Horizontal"
                },
                "index": {
                    "description": "命中第几个识别结果。可选，默认 0。\n假设共有 N 个结果，则 `index` 的取值范围为 [-N, N - 1]，其中负数使用类 Python 的规则转换为 N - index。若超出范围，则视为当前识别无结果。",
                    "type": "integer",
                    "default": 0
                },
                "template": {
                    "description": "模板图片路径，需要 image 文件夹的相对路径。必选。",
                    "$ref": "#/definitions/tasklist",
                    "default": ""
                },
                "threshold": {},
                "method": {},
                "green_mask": {
                    "description": "是否进行绿色掩码。可选，默认 false。",
                    "type": "boolean",
                    "default": false
                },
                "lower": {
                    "description": "颜色下限值。必选。最内层 list 长度需和 method 的通道数一致。",
                    "$ref": "#/definitions/colorlist"
                },
                "upper": {
                    "description": "颜色上限值。必选。最内层 list 长度需和 method 的通道数一致。",
                    "$ref": "#/definitions/colorlist"
                },
                "count": {},
                "connected": {
                    "description": "是否是相连的点才会被计数。可选，默认否。",
                    "type": "boolean",
                    "default": false
                },
                "replace": {
                    "description": "部分文字识别结果不准确，进行替换。可选。",
                    "$ref": "#/definitions/replace_type",
                    "default": []
                },
                "only_rec": {
                    "description": "是否仅识别（不进行检测，需要精确设置 roi）。可选，默认 false。",
                    "type": "boolean",
                    "default": false
                },
                "model": {},
                "labels": {
                    "description": "标注，即每个分类的名字。可选。",
                    "type": "array",
                    "items": {
                        "type": "string"
                    }
                },
                "expected": {},
                "detector": {
                    "description": "特征检测器。可选，默认 SIFT。",
                    "enum": [
                        "SIFT",
                        "KAZE",
                        "AKAZE",
                        "BRISK",
                        "ORB"
                    ],
                    "default": "SIFT"
                },
                "ratio": {
                    "description": "KNN 匹配算法的距离比值，[0 - 1.0], 越大则匹配越宽松（更容易连线）。可选，默认 0.6。",
                    "type": "number",
                    "default": 0.6,
                    "minimum": 0,
                    "maximum": 1
                },
                "custom_recognition": {
                    "description": "识别器名，同 MaaResourceRegisterCustomRecognition 接口传入的识别器名。必选。",
                    "type": "string",
                    "default": ""
                },
                "custom_recognition_param": {
                    "description": "识别器参数，任意类型，会在执行时透传。可选，默认空 json，即 {}",
                    "default": {}
                },
                "target": {
                    "description": "点击位置。可选，默认 true。",
                    "$ref": "#/definitions/target_type",
                    "default": true
                },
                "target_offset": {
                    "description": "在 target 的基础上额外移动再作为目标，四个值分别相加。可选，默认 [0, 0, 0, 0]。",
                    "$ref": "#/definitions/rect",
                    "default": [
                        0,
                        0,
                        0,
                        0
                    ]
                },
                "begin": {
                    "description": "滑动起点。可选，默认 true。",
                    "$ref": "#/definitions/target_type",
                    "default": true
                },
                "begin_offset": {
                    "description": "在 begin 的基础上额外移动再作为起点，四个值分别相加。可选，默认 [0, 0, 0, 0]。",
                    "$ref": "#/definitions/rect",
                    "default": [
                        0,
                        0,
                        0,
                        0
                    ]
                },
                "end": {
                    "description": "滑动终点。必选，默认 true。",
                    "$ref": "#/definitions/target_type",
                    "default": true
                },
                "end_offset": {
                    "description": "在 end 的基础上额外移动再作为终点，四个值分别相加。可选，默认 [0, 0, 0, 0]。",
                    "$ref": "#/definitions/rect",
                    "default": [
                        0,
                        0,
                        0,
                        0
                    ]
                },
                "duration": {
                    "description": "滑动持续时间，单位毫秒。可选，默认 200。",
                    "type": "integer",
                    "default": 200
                },
                "swipes": {
                    "description": "多个滑动的数组。必选。数组元素顺序没有影响，只基于 `starting` 确定顺序。",
                    "type": "array",
                    "items": {
                        "$ref": "#/definitions/swipe_type"
                    }
                },
                "key": {
                    "description": "要按的键，仅支持 ascii。",
                    "$ref": "#/definitions/keylist",
                    "default": 0
                },
                "input_text": {
                    "description": "要输入的文本，部分控制器仅支持 ascii。",
                    "type": "string",
                    "default": ""
                },
                "package": {},
                "exec": {
                    "description": "执行的程序路径。必选。",
                    "type": "string"
                },
                "args": {
                    "description": "执行的参数。可选。支持部分运行期参数替换：{ENTRY}, {NODE}, {IMAGE}, {BOX}, {RESOURCE_DIR}, {LIBRARY_DIR}。",
                    "type": "array",
                    "items": {
                        "type": "string"
                    },
                    "default": []
                },
                "detach": {
                    "description": "分离子进程，即不等待子进程执行完成，直接继续之后后面的节点。可选，默认 false。",
                    "type": "boolean",
                    "default": false
                },
                "custom_action": {
                    "description": "动作名，同 MaaResourceRegisterCustomAction 接口传入的动作名。必选。",
                    "type": "string",
                    "default": ""
                },
                "custom_action_param": {
                    "description": "动作参数，任意类型，会在执行时透传。可选，默认空 json，即 {}",
                    "default": {}
                }
            },
            "additionalProperties": false,
            "dependencies": {
                "recognition": {
                    "oneOf": [
                        {
                            "$comment": "DirectHit",
                            "properties": {
                                "recognition": {
                                    "const": "DirectHit"
                                }
                            }
                        },
                        {
                            "$comment": "TemplateMatch",
                            "properties": {
                                "recognition": {
                                    "const": "TemplateMatch"
                                },
                                "method": {
                                    "description": "模板匹配算法，即 cv::TemplateMatchModes。可选，默认 5 ",
                                    "enum": [
                                        1,
                                        3,
                                        5
                                    ],
                                    "default": 5
                                },
                                "threshold": {
                                    "description": "模板匹配阈值。可选，默认 0.7 。",
                                    "anyOf": [
                                        {
                                            "type": "number",
                                            "default": 0.7,
                                            "minimum": 0,
                                            "maximum": 1
                                        },
                                        {
                                            "type": "array",
                                            "items": {
                                                "type": "number",
                                                "default": 0.7,
                                                "minimum": 0,
                                                "maximum": 1
                                            }
                                        }
                                    ]
                                }
                            },
                            "anyOf": [
                                {
                                    "required": [
                                        "template"
                                    ]
                                },
                                {
                                    "required": [
                                        "template_code"
                                    ]
                                }
                            ]
                        },
                        {
                            "$comment": "FeatureMatch",
                            "properties": {
                                "recognition": {
                                    "const": "FeatureMatch"
                                },
                                "count": {
                                    "description": "匹配的特征点的数量要求（阈值），默认 4。",
                                    "type": "integer",
                                    "default": 4
                                }
                            },
                            "anyOf": [
                                {
                                    "required": [
                                        "template"
                                    ]
                                },
                                {
                                    "required": [
                                        "template_code"
                                    ]
                                }
                            ]
                        },
                        {
                            "$comment": "ColorMatch",
                            "properties": {
                                "recognition": {
                                    "const": "ColorMatch"
                                },
                                "method": {
                                    "description": "颜色匹配方式。即 cv::ColorConversionCodes。可选，默认 4 (RGB)。\n常用值：4 (RGB, 3 通道), 40 (HSV, 3 通道), 6 (GRAY, 1 通道)。",
                                    "type": "integer",
                                    "default": 4
                                },
                                "count": {
                                    "description": "符合的点的数量要求。可选，默认 1。",
                                    "type": "integer",
                                    "default": 1
                                }
                            },
                            "anyOf": [
                                {
                                    "required": [
                                        "lower",
                                        "upper"
                                    ]
                                },
                                {
                                    "required": [
                                        "lower_code",
                                        "upper_code"
                                    ]
                                },
                                {
                                    "required": [
                                        "lower_code",
                                        "upper"
                                    ]
                                },
                                {
                                    "required": [
                                        "lower",
                                        "upper_code"
                                    ]
                                }
                            ]
                        },
                        {
                            "$comment": "OCR",
                            "properties": {
                                "recognition": {
                                    "const": "OCR"
                                },
                                "model": {
                                    "description": "模型 文件夹 路径。使用 model/ocr 文件夹的相对路径。可选，默认为空。",
                                    "type": "string",
                                    "default": ""
                                },
                                "expected": {
                                    "description": "期望的结果，支持正则。必选（除非通过接口单独设置）。",
                                    "anyOf": [
                                        {
                                            "type": "string"
                                        },
                                        {
                                            "type": "array",
                                            "items": {
                                                "type": "string"
                                            },
                                            "minItems": 1
                                        }
                                    ]
                                }
                            },
                            "anyOf": [
                                {
                                    "required": [
                                        "expected"
                                    ]
                                },
                                {
                                    "required": [
                                        "expected_code"
                                    ]
                                }
                            ]
                        },
                        {
                            "$comment": "NeuralNetworkClassify",
                            "properties": {
                                "recognition": {
                                    "const": "NeuralNetworkClassify"
                                },
                                "model": {
                                    "description": "模型文件路径。使用 model/classify 文件夹的相对路径。必选。",
                                    "type": "string",
                                    "default": ""
                                },
                                "expected": {
                                    "description": "期望的分类下标。必选",
                                    "$ref": "#/definitions/expected_type"
                                }
                            },
                            "anyOf": [
                                {
                                    "required": [
                                        "model",
                                        "expected"
                                    ]
                                },
                                {
                                    "required": [
                                        "model_code",
                                        "expected_code"
                                    ]
                                },
                                {
                                    "required": [
                                        "model_code",
                                        "expected"
                                    ]
                                },
                                {
                                    "required": [
                                        "model",
                                        "expected_code"
                                    ]
                                }
                            ]
                        },
                        {
                            "$comment": "NeuralNetworkDetect",
                            "properties": {
                                "recognition": {
                                    "const": "NeuralNetworkDetect"
                                },
                                "model": {
                                    "description": "模型文件路径。使用 model/detect 文件夹的相对路径。必选。",
                                    "type": "string",
                                    "default": ""
                                },
                                "threshold": {
                                    "description": "模型置信度阈值。可选，默认 0.3 。",
                                    "anyOf": [
                                        {
                                            "type": "number"
                                        },
                                        {
                                            "type": "array",
                                            "items": {
                                                "type": "number"
                                            },
                                            "minItems": 1
                                        }
                                    ],
                                    "default": 0.3
                                },
                                "expected": {
                                    "description": "期望的分类下标。必选",
                                    "$ref": "#/definitions/expected_type"
                                }
                            },
                            "anyOf": [
                                {
                                    "required": [
                                        "model",
                                        "expected"
                                    ]
                                },
                                {
                                    "required": [
                                        "model_code",
                                        "expected_code"
                                    ]
                                },
                                {
                                    "required": [
                                        "model_code",
                                        "expected"
                                    ]
                                },
                                {
                                    "required": [
                                        "model",
                                        "expected_code"
                                    ]
                                }
                            ]
                        },
                        {
                            "$comment": "Custom",
                            "properties": {
                                "recognition": {
                                    "const": "Custom"
                                }
                            },
                            "anyOf": [
                                {
                                    "required": [
                                        "custom_recognition"
                                    ]
                                },
                                {
                                    "required": [
                                        "custom_recognition_code"
                                    ]
                                }
                            ]
                        }
                    ]
                },
                "action": {
                    "oneOf": [
                        {
                            "$comment": "DoNothing",
                            "properties": {
                                "action": {
                                    "const": "DoNothing"
                                }
                            }
                        },
                        {
                            "$comment": "Click",
                            "properties": {
                                "action": {
                                    "const": "Click"
                                },
                                "target": {
                                    "description": "点击的位置。可选，默认 true。",
                                    "$ref": "#/definitions/target_type",
                                    "default": true
                                },
                                "target_offset": {
                                    "description": "在 target 的基础上额外移动再点击，四个值分别相加。可选，默认 [0, 0, 0, 0]。",
                                    "$ref": "#/definitions/rect",
                                    "default": [
                                        0,
                                        0,
                                        0,
                                        0
                                    ]
                                }
                            }
                        },
                        {
                            "$comment": "Swipe",
                            "properties": {
                                "action": {
                                    "const": "Swipe"
                                }
                            }
                        },
                        {
                            "$comment": "MultiSwipe",
                            "properties": {
                                "action": {
                                    "const": "MultiSwipe"
                                }
                            },
                            "anyOf": [
                                {
                                    "required": [
                                        "swipes"
                                    ]
                                },
                                {
                                    "required": [
                                        "swipes_code"
                                    ]
                                }
                            ]
                        },
                        {
                            "$comment": "Key",
                            "properties": {
                                "action": {
                                    "const": "Key"
                                }
                            },
                            "anyOf": [
                                {
                                    "required": [
                                        "key"
                                    ]
                                },
                                {
                                    "required": [
                                        "key_code"
                                    ]
                                }
                            ]
                        },
                        {
                            "$comment": "InputText/Text",
                            "properties": {
                                "action": {
                                    "enum": [
                                        "InputText",
                                        "Text"
                                    ]
                                }
                            },
                            "anyOf": [
                                {
                                    "required": [
                                        "input_text"
                                    ]
                                },
                                {
                                    "required": [
                                        "input_text_code"
                                    ]
                                }
                            ]
                        },
                        {
                            "$comment": "StartApp",
                            "properties": {
                                "action": {
                                    "const": "StartApp"
                                },
                                "package": {
                                    "description": "启动入口。可选，默认空。",
                                    "type": "string",
                                    "default": ""
                                }
                            }
                        },
                        {
                            "$comment": "StopApp",
                            "properties": {
                                "action": {
                                    "const": "StopApp"
                                },
                                "package": {
                                    "description": "关闭要关闭的程序。可选，默认空。",
                                    "type": "string",
                                    "default": ""
                                }
                            }
                        },
                        {
                            "$comment": "StopTask",
                            "properties": {
                                "action": {
                                    "const": "StopTask"
                                }
                            }
                        },
                        {
                            "$comment": "Command",
                            "properties": {
                                "action": {
                                    "const": "Command"
                                }
                            }
                        },
                        {
                            "$comment": "Custom",
                            "properties": {
                                "action": {
                                    "const": "Custom"
                                }
                            },
                            "anyOf": [
                                {
                                    "required": [
                                        "custom_action"
                                    ]
                                },
                                {
                                    "required": [
                                        "custom_action_code"
                                    ]
                                }
                            ]
                        }
                    ]
                }
            }
        }
    },
    "definitions": {
        "rect": {
            "type": "array",
            "items": {
                "type": "number"
            },
            "minItems": 4,
            "maxItems": 4
        },
        "tasklist": {
            "anyOf": [
                {
                    "type": "string"
                },
                {
                    "type": "array",
                    "items": {
                        "type": "string"
                    }
                }
            ]
        },
        "colorlist": {
            "anyOf": [
                {
                    "type": "array",
                    "items": {
                        "type": "integer"
                    },
                    "minItems": 1
                },
                {
                    "type": "array",
                    "items": {
                        "type": "array",
                        "items": {
                            "type": "integer"
                        },
                        "minItems": 1
                    },
                    "minItems": 1
                }
            ]
        },
        "replace_type": {
            "anyOf": [
                {
                    "type": "array",
                    "items": {
                        "type": "string"
                    },
                    "minItems": 2,
                    "maxItems": 2
                },
                {
                    "type": "array",
                    "items": {
                        "type": "array",
                        "items": {
                            "type": "string"
                        },
                        "minItems": 2,
                        "maxItems": 2
                    },
                    "minItems": 1
                }
            ]
        },
        "expected_type": {
            "anyOf": [
                {
                    "type": "integer"
                },
                {
                    "type": "array",
                    "items": {
                        "type": "integer"
                    },
                    "minItems": 1
                }
            ]
        },
        "keylist": {
            "anyOf": [
                {
                    "type": "integer",
                    "minimum": 0,
                    "maximum": 127
                },
                {
                    "type": "array",
                    "items": {
                        "type": "integer",
                        "minimum": 0,
                        "maximum": 127
                    },
                    "minItems": 1
                }
            ]
        },
        "roi_type": {
            "anyOf": [
                {
                    "type": "string"
                },
                {
                    "$ref": "#/definitions/rect"
                }
            ]
        },
        "target_type": {
            "anyOf": [
                {
                    "type": "boolean"
                },
                {
                    "type": "string"
                },
                {
                    "$ref": "#/definitions/rect"
                }
            ]
        },
        "wait_freezes_type": {
            "anyOf": [
                {
                    "type": "integer",
                    "minimum": 0,
                    "default": 1
                },
                {
                    "type": "object",
                    "properties": {
                        "time": {
                            "description": "连续 time 毫秒 画面 没有较大变化 才会退出动作。可选，默认 1。",
                            "type": "integer",
                            "minimum": 0,
                            "default": 1
                        },
                        "target": {
                            "description": "等待的目标。可选，默认 true。",
                            "$ref": "#/definitions/target_type",
                            "default": true
                        },
                        "target_offset": {
                            "description": "在 target 的基础上额外移动再作为等待目标，四个值分别相加。可选，默认 [0, 0, 0, 0]。",
                            "$ref": "#/definitions/rect",
                            "default": [
                                0,
                                0,
                                0,
                                0
                            ]
                        },
                        "threshold": {
                            "description": "判断“没有较大变化”的模板匹配阈值。可选，默认 0.95 。",
                            "type": "number",
                            "minimum": 0,
                            "maximum": 1,
                            "default": 0.95
                        },
                        "method": {
                            "description": "判断“没有较大变化”的模板匹配算法，即 cv::TemplateMatchModes。可选，默认 5 。",
                            "type": "integer",
                            "enum": [
                                1,
                                3,
                                5
                            ],
                            "default": 5
                        },
                        "rate_limit": {
                            "description": "识别速率限制，单位毫秒。\n每次识别最低消耗 `rate_limit` 毫秒，不足的时间将会 sleep 等待。",
                            "type": "integer",
                            "minimum": 0,
                            "default": 1000
                        },
                        "timeout": {
                            "description": "识别超时时间，毫秒。默认 20 * 1000 。",
                            "type": "integer",
                            "minimum": 0,
                            "default": 20000
                        }
                    }
                }
            ]
        },
        "swipe_type": {
            "type": "object",
            "properties": {
                "begin": {
                    "description": "滑动起点。可选，默认 true。",
                    "$ref": "#/definitions/target_type",
                    "default": true
                },
                "begin_offset": {
                    "description": "在 begin 的基础上额外移动再作为起点，四个值分别相加。可选，默认 [0, 0, 0, 0]。",
                    "$ref": "#/definitions/rect",
                    "default": [
                        0,
                        0,
                        0,
                        0
                    ]
                },
                "end": {
                    "description": "滑动终点。必选，默认 true。",
                    "$ref": "#/definitions/target_type",
                    "default": true
                },
                "end_offset": {
                    "description": "在 end 的基础上额外移动再作为终点，四个值分别相加。可选，默认 [0, 0, 0, 0]。",
                    "$ref": "#/definitions/rect",
                    "default": [
                        0,
                        0,
                        0,
                        0
                    ]
                },
                "duration": {
                    "description": "滑动持续时间，单位毫秒。可选，默认 200",
                    "type": "integer",
                    "default": 200
                },
                "starting": {
                    "description": "滑动起始时间，单位毫秒。可选，默认 0 。该滑动会在本 action 中第 `starting` 毫秒才开始。",
                    "type": "integer",
                    "default": 0
                }
            }
        }
    }
}